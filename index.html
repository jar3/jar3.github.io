<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warm Up Life</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: orange;
            font-family: Arial, sans-serif;
            margin: 0;
            position: relative;
        }
        #contador {
            font-size: 3em;
            font-weight: bold;
        }
        #texto {
            font-size: 1.5em;
            margin-top: 10px;
        }
        #reiniciar {
            width: 1px;
            height: 1px;
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent;
            border: none;
            cursor: pointer;
        }
    </style>
    <!-- Importar Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB7kJR_ya0N6uFawxlbgp2AwbiTD596C4s",
            authDomain: "contador-capatres.firebaseapp.com",
            databaseURL: "https://contador-capatres.firebaseio.com",
            projectId: "contador-capatres",
            storageBucket: "contador-capatres.appspot.com",
            messagingSenderId: "174595932515",
            appId: "1:174595932515:web:4937e59adc08e756ca9356",
            measurementId: "G-XZEMS1K4ML"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Referencia al documento en Firestore
        const docRef = db.collection('contador-dias-sin-viaje').doc('contador');

        // Función para obtener la fecha actual en milisegundos
        const obtenerFechaActual = () => new Date().getTime();

        // Función para inicializar la fecha de inicio si no está definida
        const inicializarFechaInicio = () => {
            docRef.get().then(doc => {
                if (!doc.exists) {
                    const fechaActual = obtenerFechaActual();
                    docRef.set({ fechaInicio: fechaActual });
                }
                actualizarContador();
            }).catch(error => {
                console.error('Error al obtener documento:', error);
            });
        };

        // Función para actualizar la fecha de inicio en Firestore
        const actualizarFechaInicio = () => {
            const fechaActual = obtenerFechaActual();
            docRef.set({ fechaInicio: fechaActual });
        };

        // Función para obtener la fecha de inicio desde Firestore
        const obtenerFechaInicio = () => {
            return docRef.get().then(doc => {
                if (doc.exists) {
                    return doc.data().fechaInicio;
                } else {
                    return null;
                }
            }).catch(error => {
                console.error('Error al obtener documento:', error);
                return null;
            });
        };

        // Función para reiniciar el contador
        const reiniciarContador = () => {
            actualizarFechaInicio();
        };

        // Elementos del DOM
        const contadorElemento = document.getElementById('contador');
        const botonReiniciar = document.getElementById('reiniciar');

        // Función para actualizar el contador
        const actualizarContador = () => {
            obtenerFechaInicio().then(fechaInicio => {
                if (fechaInicio) {
                    const ahora = obtenerFechaActual();
                    const diferencia = ahora - fechaInicio;

                    const segundosTotales = Math.floor(diferencia / 1000);
                    const dias = Math.floor(segundosTotales / (3600 * 24));
                    const horas = Math.floor((segundosTotales % (3600 * 24)) / 3600);
                    const minutos = Math.floor((segundosTotales % 3600) / 60);
                    const segundos = segundosTotales % 60;

                    contadorElemento.textContent = `${dias}d ${horas}h ${minutos}m ${segundos}s`;
                } else {
                    // Si no hay fecha de inicio, mostrar contador en cero
                    contadorElemento.textContent = `0d 0h 0m 0s`;
                }
            }).catch(error => {
                console.error('Error al obtener fecha de inicio desde Firestore:', error);
            });
        };

        // Añade el evento de clic al botón de reiniciar
        botonReiniciar.addEventListener('click', reiniciarContador);

        // Al cargar la página, inicializar y actualizar el contador
        inicializarFechaInicio();
        setInterval(actualizarContador, 1000); // Actualizar cada segundo
    </script>
</head>
<body>
    <div id="contador">0d 0h 0m 0s</div>
    <div id="texto">Días sin irme de viaje</div>
    <button id="reiniciar">Reiniciar Contador</button>
</body>
</html>
